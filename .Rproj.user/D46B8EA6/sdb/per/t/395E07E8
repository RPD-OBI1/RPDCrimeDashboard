{
    "collab_server" : "",
    "contents" : "---\ntitle: \"`r params$sectionname` Crime Dashboard, as of `r format(Sys.Date() - 4, '%d %B, %Y')`\"\noutput: \n  flexdashboard::flex_dashboard:\n    logo: Z:/Projects/dashboard/RPDCrimeDashboard/Objects/RPDLogoSMALL.png\n    orientation: column\n    vertical_layout: fill\n    theme: cerulean\nparams:\n    sectionname:\n        label: \"Section\"\n        value: \"Genesee\"\n        \n---\n\n```{r loadpackages, include=FALSE}\n\nlibrary(knitr)\nlibrary(flexdashboard)\nlibrary(RColorBrewer)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(KernSmooth)\nlibrary(raster)\nlibrary(leaflet)\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(jsonlite)\nlibrary(tidyr)\nlibrary(DT)\nlibrary(RODBC)\nlibrary(treemap)\nlibrary(d3treeR)\nlibrary(RColorBrewer)\n\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/aoristicDayWeek.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/guntablenest.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/kerntorast.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/hotspotMap.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/hotspotMapSV.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/LERMS_incidents.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/nestedbeattable.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/plotlyhmap.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/SPC.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/pullMCUdata.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/loadshootingvictims.R\")\nsource(\"Z:/Projects/dashboard/RPDCrimeDashboard/Functions/CFSloc.R\")\n\nsimpleCap <- function(x) {\n  s <- strsplit(x, \" \")[[1]]\n  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),\n      sep = \"\", collapse = \" \")\n}\n\nsectionsmatch <- data.frame(section = c(1, 3, 5, 7, 9),\n                            sectionname = c(\"Lake\", \"Genesee\", \"Goodman\", \"Clinton\", \"Central\"),\n                            # lng1 = c(-77.617488, -77.604633, -77.615712, -77.575370, -77.592894),\n                            # lat1 = c(43.158172, 43.114570, 43.124344, 43.159093, 43.138862),\n                            # lng2 = c(-77.668684, -77.686093, -77.522970, -77.626865, -77.635598),\n                            # lat2 = c(43.264020, 43.159699, 43.237813, 43.257633, 43.165201),\n                            stringsAsFactors = FALSE)\nsection <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname),\"section\"]\n# lng1FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), \"lng1\"]\n# lat1FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), \"lat1\"]\n# lng2FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), \"lng2\"]\n# lat2FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), \"lat2\"]\n\n\n\noverviewPlot <- function(control = controllimits %>% filter(Crime == \"Firearm\"), \n                         spcObj = firearmSPC,\n                         dat = histdata %>% filter(CrimeType == \"Firearm\"),\n                         currentyear = curr.year,\n                         title = \"Historical Counts for Firearm Crime\"\n                             ) {\n    q <- dat %>% \n        plot_ly(\n            x = ~Yr, \n            y = ~Counts, \n            type = \"scatter\", \n            mode = \"lines+markers\",\n            line = list(color = \"black\"),\n            name = \"Historical\",\n            hoverinfo = \"name+x+y\",\n            hoverlabel = list(bgcolor = \"white\", font = list(color = \"black\"))) %>% \n        add_trace(data = control,\n                  x = ~Year,\n                  y = ~LowerLimit,\n                  type = \"scatter\",\n                  mode = \"lines\",\n                  line = list(color = \"grey\", dash = \"dash\"),\n                  name = \"Lower Limit\",\n                  hoverinfo = \"name+y\",\n                  hoverlabel = list(bgcolor = \"white\", font = list(color = \"black\"))) %>%\n        add_trace(data = control,\n                  x = ~Year,\n                  y = ~UpperLimit,\n                  type = \"scatter\",\n                  mode = \"lines\",\n                  line = list(color = \"grey\", dash = \"dash\"),\n                  name = \"Upper Limit\",\n                  hoverinfo = \"name+y\",\n                  hoverlabel = list(bgcolor = \"white\", font = list(color = \"black\"))) %>%\n        add_trace(data = spcObj[[5]] %>% group_by(Value) %>% count(),\n                  x = curr.year,\n                  y = ~Value,\n                  type = \"scatter\",\n                  mode = \"markers\",\n                  marker = list(color = \"grey\"),\n                  size = ~n,\n                  opacity = .3,\n                  name = \"Sims\",\n                  hovertext = ~paste0(n, \" of 1000 sims result in \", Value, \" at year end.\"),\n                  hoverinfo = \"text\",\n                  hoverlabel = list(bgcolor = \"white\", font = list(color = \"black\"))) %>%\n        add_trace(x = currentyear,\n                  y = mean(spcObj[[5]]$Value),\n                  type = \"scatter\",\n                  mode = \"markers\",\n                  name = \"Avg sim\",\n                  hoverinfo = \"name\",\n                  marker = list(size = 10, color = \"blue\")) %>%\n        layout(showlegend = FALSE,\n               xaxis = list(title = \"\"),\n               yaxis = list(title = \"\"),\n               title = title)\n    return(q)\n    \n}\n\n\n```\n\n```{r setup}\n\n# Read in previously-created list of maps; keep only the relevant section one\nsectionmap <- readRDS(\"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/sectionmaplist.RDS\")[params$sectionname][[1]]\n\ncurr.year <- as.numeric(format(Sys.Date(), '%Y')) ### This current year to automatically reference the current year\nbegindate <- paste0(curr.year, '-01-01') ### For CFS to automatically create the begindate based on current year\n\n#sevenDayGroupTable is a lookup table to get the current week (Group) from the date\n#Because it uses length(Date) from seq.Date, it should work even in leap years\n\nsevenDayGroupTable <- data.frame(Date = seq.Date(from = as.Date(begindate),\n                                                 to = as.Date(paste0(curr.year, \"-12-31\")),\n                                                 by = 1)) %>%\n    mutate(DOY = 1:length(Date),\n           Group = c(rep(1:51, each = 7), \n                     rep(52, times = length(Date) - 357)))\n\ncurr.week <- sevenDayGroupTable$Group[match(as.numeric(format(Sys.Date(), \n                                                             '%j')), \n                                           sevenDayGroupTable$DOY)] - 1\n\nfirearm.desc <- trimws(c('Prohibited Use of Weapon City Limits', \n                        'Use of Dangerous Weapon', \n                        'Criminal Use Firearm 1st: Commit Violent Class B Felony', \n                        'Discharges Loaded Firearm', \n                        'Use Firearm 1st: Possess a Deadly Weapon-Loaded',\n                        'Criminal Use Firearm 2nd: Possess Deadly Weapon: Loaded', \n                        'Use Firearm 1st: Display Firearm', \n                        'Criminal Use Firearm 2nd: Display Firearm'))\n\nfirearmCrimeTypes <- c(\"Aggravated Assault\", \"Robbery\", \"Homicide\", \"Rape\", \"Simple Assault\")\n\n#load in RPD's crime data\n\ndf <- readRDS(\"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/sectiondflist.RDS\")[params$sectionname][[1]]\n\n#use beatNames to make factor levels for beats\nbeatNames <- df %>%\n    dplyr::select(GEOBeat) %>%\n    unique() %>% \n    filter(! grepl(x = GEOBeat, pattern = \"\\\\*\")) %>% #remove *** as a beat name\n    arrange(substr(GEOBeat, 3, 3), GEOBeat) %>%\n    mutate(GEOBeat = as.factor(GEOBeat)) #this keeps *** as a factor level\n\nCPWs <- df %>% filter(CrimeType == \"Dangerous Weapons\" & \n                          !trimws(Description) %in% firearm.desc &\n                          as.numeric(WeaponIBRValue) < 11) %>%\n    mutate(OccurFromDate = as.character(OccurFromDate)) #for table display purposes\n\ncrimes <- c('Aggravated Assault', 'Arson', 'Burglary', 'Homicide', 'Larceny', 'MV Theft', 'Rape', 'Robbery', 'Firearm')\nsec <- c('Lake', 'Genesee', 'Goodman', 'Clinton', 'Central')\n\npal <- brewer.pal(name = \"Reds\", n = 9)\n\nPropVals <- read.csv(\"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/ProportionsAndCounts.csv\", \n                     header= T) %>%\n    filter(Section == params$sectionname)\nShootingControlLimits <- readr::read_csv(\"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/3YrWeightedControlLimitsShootings.csv\") %>%\n    filter(Section == params$sectionname)\nShootingProps <- readr::read_csv(\"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/ProportionsAndCountsShootings.csv\") %>%\n    dplyr::filter(Section == params$sectionname)\n\nhistdata <- readr::read_csv(file = \"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/historicaldata.csv\") %>%\n    dplyr::filter(Section == section)\n\ncontrollimits <- readr::read_csv(file = \"Z:/Projects/dashboard/RPDCrimeDashboard/Objects//3YrWeightedControlLimits.csv\") %>%\n    dplyr::filter(Section == params$sectionname)\n\ncontrollimits <- rbind(data.frame(controllimits, Year = 2017),\n                       data.frame(controllimits, Year = 2018),\n                       data.frame(controllimits, Year = 2019))\n\nmculist <- pullMCUdata()\nMCUhoms <- mculist[[1]] %>%\n    filter(Section == params$sectionname) %>%\n    mutate(CrimeType = \"Homicide\",\n           DateOfEvent = as.Date(DateOfEvent, format = \"%Y-%m-%d\"),\n           DOYofEvent = as.numeric(format(DateOfEvent, \"%j\")),\n           YearofEvent = as.numeric(format(DateOfEvent, \"%Y\")),\n           CaseStatus = unname(sapply(CaseStatus, simpleCap))) %>%\n    filter(YearofEvent == curr.year) %>%\n    rename(sec = Section, \n           Lat = Latitude, \n           Lon = Longitude, \n           FullAddress = Address) %>%\n    left_join(sevenDayGroupTable, by = c(\"DOYofEvent\" = \"DOY\")) %>%\n    dplyr::select(-Date) %>%\n    dplyr::rename(\"SevenDaysGroup\" = Group)\n\n\n\nperson <- mculist[[2]]\nrm(mculist)\n\npersonincident <- left_join(MCUhoms, person, by = \"CaseNumber\")\n\nsv <- loadshootingvictims()\ndrops <- c(\"Lat\", \"Lon\")\nsvjoined <- left_join(x = sv, y = df, by = c(\"CaseNumber\" = \"CRNum\")) %>%\n    dplyr::select(-one_of(drops)) %>%\n    rename(Lat = Latitude, Lon = Longitude) %>%\n    filter(sec == params$sectionname)\nrm(sv)\n\nloc <- CFSloc()\n#Exclude is for later use, excluding from hotspots/mapping/etc\nexclude <- c(\"630 North Clinton Ave, Rochester, NY, 14605\", \n             \"185 Exchange Blvd, Rochester, NY, 14614\",\n             \"1099 Jay St, Rochester, NY, 14611\")\n\nsectionSPC <- readRDS(\"Z:/Projects/dashboard/RPDCrimeDashboard/Objects/sectionSPClist.RDS\")[params$sectionname][[1]]\nfirearmSPC <- sectionSPC$Firearm\nsvSPC <- sectionSPC$SV\nhomicideSPC <- sectionSPC$Homicide\nrapeSPC <- sectionSPC$Rape\nrobSPC <- sectionSPC$Rob\nasltSPC <- sectionSPC$Aslt\nburgSPC <- sectionSPC$Burg\nlarcSPC <- sectionSPC$Larc\n\nodbcCloseAll()\n\n```\n\n\n\nOverview {data-navmenu=\"Home\"}\n======================================================================\n\nColumn{data-width=500}\n------------------------------------------------------------------------------\n\n### Breakdown of crimes & action limits\n\n```{r}\n#Check to make sure this year's firearm homicides are in the firearm data\nif(nrow(MCUhoms) > 0){\n    MCUhoms$CaseNumber <- paste0(\"20\", \n                                 substr(MCUhoms$CaseNumber, 1, 3),\n                                 \"00\", \n                                 substr(MCUhoms$CaseNumber, 4, 9))\n    }\n\nfirearmhoms <- MCUhoms %>% \n    filter(YearofEvent == curr.year, WeaponType == \"Firearm\")\n# if(any(! firearmhoms$CaseNumber %in% filter(df, Firearm == \"Firearm\"))){\n#     cat(\"There are firearm homicides that do not appear in the firearm data due to LERMS issues.\")\n# }\n\ntab <- data.frame(CrimeTypes = c(\"Firearm crime\", \"Shootings\", \"Robbery\", \n                                 \"Aggravated Assault\", \"Burglary\", \"Larceny\"),\n                  Counts = c(firearmSPC[[4]], svSPC[[4]], robSPC[[4]], \n                             asltSPC[[4]], burgSPC[[4]], larcSPC[[4]]),\n                  RiskOfRed = c(firearmSPC[[2]], svSPC[[2]], robSPC[[2]], \n                                asltSPC[[2]], burgSPC[[2]], larcSPC[[2]]),\n                  ChanceOfGreen = c(firearmSPC[[3]], svSPC[[3]], robSPC[[3]], \n                                    asltSPC[[3]], burgSPC[[3]], larcSPC[[3]]))\n#knitr::kable(tab, col.names = c(\"Crime Types\", \n#                                \"YTD Totals\", \n#                                \"% chance of exceeding upper action limit\", \n#                                \"% chance of beating lower action limit\"))\nDT::datatable(tab,\n              rownames = FALSE,\n              colnames = c(\"Crime Types\", \n                           \"YTD Totals\", \n                           \"% chance of exceeding upper action limit\", \n                           \"% chance of beating lower action limit\"),\n              options = list(dom = 'tf',\n                             columnDefs = list(list(className = 'dt-right', targets = 0:3))))\n```\n\n### Closure rates\n\n```{r}\nCrimeTypes <- c(\"Aggravated Assault\", \"Burglary\", \"Homicide\", \"Larceny\",\n                 \"MV Theft\", \"Rape\", \"Robbery\", \"Dangerous Weapons\")\n\ntreedata <- df %>%\n    filter(CrimeType %in% CrimeTypes) %>%\n    filter(SevenDaysGroup %in% 1:curr.week) %>%\n    count(CrimeType = CrimeType,\n          Clearance = ClearanceStatusValue, \n          Closure = CaseStatusValue) %>%\n    ungroup() %>%\n    group_by(CrimeType) %>%\n    mutate(CrimeTypeCount = sum(n)) %>%\n    group_by(CrimeType, Closure) %>%\n    mutate(ClosureCount = sum(n)) %>%\n    ungroup() %>%\n    mutate(CrimeType = paste0(CrimeType, \" (\", \n                              CrimeTypeCount, \", \",\n                              round(100 * CrimeTypeCount / sum(n), 2), \n                              \"%)  \"),\n           Closure = paste0(Closure, \" (\",\n                            ClosureCount, \", \",\n                            round(100 * ClosureCount / CrimeTypeCount, 2),\n                            \"%)  \"),\n           Clearance = paste0(Clearance, \" (\",\n                              n, \", \",\n                              round(100 * n / ClosureCount, 2),\n                              \"%)\"))\n\npdf(NULL)\nclearanceTreeMap <- d3tree2(\n    treemap(\n        treedata,\n        index = c(\"CrimeType\", \"Closure\", \"Clearance\"),\n        vSize = \"n\",\n        draw = FALSE),\n        rootname = \"Total\"\n    )\n\nclearanceTreeMap\n```\n\nColumn {data-width=500 .tabset .tabset-fade}\n------------------------------------------------------------------------------\n\n### Firearm Crime\n\n```{r}\nfirearmcontrol <- filter(controllimits, Crime == \"Firearm\")\nSimsAvg <- mean(firearmSPC[[5]]$Value)\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Firearm\"),\n             spcObj = firearmSPC,\n             dat = histdata %>% filter(CrimeType == \"Firearm\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Firearm Crime\")\n\n```\n\n### Shooting Victims\n\n```{r shootingsmainpage}\n\noverviewPlot(control = ShootingControlLimits,\n             spcObj = svSPC,\n             dat = histdata %>% filter(CrimeType == \"Shooting\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Shootings\")\n\n```\n\n### Robbery\n\n```{r}\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Robbery\"),\n             spcObj = robSPC,\n             dat = histdata %>% filter(CrimeType == \"Robbery\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Robbery\")\n\n\n```\n\n### Aggravated Assault\n\n```{r}\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Aggravated Assault\"),\n             spcObj = asltSPC,\n             dat = histdata %>% filter(CrimeType == \"Aggravated Assault\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Agg Assault\")\n\n```\n\n### Burglary\n\n```{r}\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Burglary\"),\n             spcObj = burgSPC,\n             dat = histdata %>% filter(CrimeType == \"Burglary\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Burglary\")\n\n```\n\n### Larceny\n\n```{r}\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Larceny\"),\n             spcObj = larcSPC,\n             dat = histdata %>% filter(CrimeType == \"Larceny\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Larceny\")\n```\n\n### Homicide\n\n```{r}\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Homicide\"),\n             spcObj = homicideSPC,\n             dat = histdata %>% filter(CrimeType == \"Homicide\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Homicide\")\n```\n\n### Rape\n\n```{r}\n\noverviewPlot(control = controllimits %>% filter(Crime == \"Rape\"),\n             spcObj = rapeSPC,\n             dat = histdata %>% filter(CrimeType == \"Rape\"),\n             currentyear = curr.year,\n             title = \"Historical Counts for Rape\")\n```\n\nFirearm Crime {data-navmenu=\"Violent Crime\"}\n======================================================================\n\nColumn {data-width=400}\n------------------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Firearm Crime\", cex = 2, col = 'black')\n\n```\n\n### Projection\n\n```{r}\n\nfirearmSPC[[1]]\n\n```\n\n### Aoristic heatmap\n\n```{r}\ndf$WeaponIBRValue <- as.numeric(df$WeaponIBRValue)\nmat <- aoristicDayWeek(filter(df, WeaponIBRValue < 11))\nplotlyhmap(mat)\n\n```\n\nColumn {data-width=400 .tabset .tabset-fade}\n------------------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r whydoesthisfail}\n\nguns <- dplyr::filter(df, Firearm == \"Firearm\")\nmap <- hotspotMap(sectionmap, \n                  dplyr::filter(guns, Lat != -361))\nmap\n\n```\n\n### 28 day Hotspot map\n\n```{r}\n\nguns28 <- guns %>%\n    filter(Lat != -361 & SevenDaysGroup > curr.week - 4)\nif(nrow(guns28) > 0){\n    map <- hotspotMap(sectionmap, guns28)\n    map\n}\n\n```\n\nColumn{data-width=300 .tabset .tabset-fade}\n-------------------------------------------------------------------------------\n\n### Beats\n\nThere were `r nrow(guns)` overall firearm-involved crimes (including simulated and imitation firearms).\n\n```{r}\ndat <- df %>%\n    filter(Firearm == \"Firearm\")\n\nx <- nestedbeattable(dat)\nx <- x[substr(x$Beat, 3, 3) == section, c(\"Beat\", \"count\")] #filtering out non-relevant rows\n\nDT::datatable(x %>% mutate(Beat = factor(Beat)),\n              rownames = FALSE,\n              colnames = c('Beat', 'Count'),\n              options = list(dom = 'tf', \n                             pageLength = 100, \n                             columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\n### Crime Types\n\nThere were `r nrow(guns)` overall firearm-involved crimes (including simulated and immitation firearms).\n\n```{r}\n\nDT::datatable(guntablenest(df), \n              rownames = FALSE,\n              colnames = c(\"Crime Type\", \"Description\", \"Counts\"), \n              options = list(pageLength = 100, \n                             dom = 'tf',\n                             ordering = FALSE,\n                             columnDefs = list(list(className = 'dt-right', targets = 0:2))))\n```\n\n### CPWs\n\nThere were `r nrow(CPWs)` CPW crimes (excluding knives/brass knuckle crimes). These CPWs are not counted in the overall firearm-related statistics.\n\n```{r}\n\nDT::datatable(CPWs[, c(\"FullAddress\", \"Beat\", \"OccurFromDate\", \"Description\")],\n              filter = 'top',\n              rownames = FALSE,\n              colnames = c('Address', 'Beat', 'Date', 'Description'),\n              options = list(pageLength = 100, \n                             dom = 'tf',\n                             columnDefs = list(list(className = 'dt-right', targets = 0:3))))\n```\n\nShooting Victims {data-navmenu=\"Violent Crime\"}\n======================================================================\n\nColumn {data-width=400}\n----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Shooting Victims\", cex = 2, col = 'black')\n\n```\n\n### Projection\n\n```{r}\nsvSPC[[1]]\n\n```\n\n### Aoristic Heatmap\n\n```{r}\nif(nrow(svjoined) > 0){\n    mat <- aoristicDayWeek(svjoined)\n    plotlyhmap(mat)\n}\n\n\n```\n\nColumn {data-width=400 .tabset .tabset-fade}\n----------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r}\nif(nrow(svjoined) > 0){\n    dohotspot <- ifelse(nrow(svjoined) > 10, yes = TRUE, no = FALSE)\n    map <- hotspotMapSV(basemap = sectionmap, \n                        mapdf = svjoined, \n                        doHotSpot = dohotspot)\n    map\n}\n\n```\n\n### 28 day Hotspot map\n\n```{r}\n\nsvjoin28 <- dplyr::filter(svjoined,\n                   SevenDaysGroup >= curr.week - 3)\n\nif(nrow(svjoin28) > 0){\n    dohotspot <- ifelse(nrow(svjoin28) > 10, yes = TRUE, no = FALSE)\n    \n    map <- hotspotMapSV(basemap = sectionmap, \n                        mapdf = svjoin28, \n                        doHotSpot = dohotspot)\n    map\n}\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n----------------------------------------------------------------------\n\n### Beats\n\nThere have been `r nrow(svjoined)` shooting victims thus far.\n\n```{r}\nif(nrow(svjoined) > 0){\n    x <- nestedbeattable(svjoined)\n    x <- x[substr(x$Beat, 3, 3) == section, c(\"Beat\", \"count\")] \n    #filtering out non-relevant rows\n    DT::datatable(x %>% mutate(Beat = factor(Beat)),\n                  rownames = FALSE,\n                  colnames = c(\"Beat\", \"Count\"),\n                  options = list(pageLength = 100, \n                                dom = 'tf', \n                                columnDefs = list(list(className = 'dt-right', targets = 0:1)))\n                  )\n}\n\n```\n\n### Multiples & Homicides\n\nThere were `r nrow(svjoined)` total shooting victims in `r length(unique(svjoined$CaseNumber))` incidents.\n\n`r nrow(filter(svjoined, CrimeType.x == \"Homicide\"))` of these victims are victims of homicide.\n\n```{r}\n\nif(nrow(svjoined) > 0){\n    temptab <- svjoined %>% count(CaseNumber)\n    temptab$n <- factor(temptab$n, levels = 1:max(temptab$n))\n    temptab$n %>% \n        table() %>%\n        as.data.frame() %>%\n        arrange(.) %>%\n        \n    DT::datatable(filter = 'top',\n                  rownames = FALSE, \n                  colnames = c(\"Victims per Incident\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf', \n                                 ordering = FALSE,\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n}\n\n```\n\nRobbery {data-navmenu=\"Violent Crime\"}\n======================================================================\n\nColumn {data-width=400}\n-----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Robbery\", cex = 2, col = 'black')\n\n```\n\n### Projection\n\n```{r}\n\nrobSPC[[1]]\n\n```\n\n### Aoristic Heatmap\n\n```{r}\nrobs <- filter(df, CrimeType == \"Robbery\")\nmat <- aoristicDayWeek(robs)\nplotlyhmap(mat)\n```\n\n\nColumn {data-width=400 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r}\n\nrobsgeo <- filter(df, Lat != -361 & CrimeType == \"Robbery\")\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = robsgeo)\nmap\n\n```\n\n### 28 day Hotspot map\n\n```{r}\n\nrobsgeo <- filter(df, Lat != -361 & \n                      CrimeType == \"Robbery\" & \n                      SevenDaysGroup >= curr.week - 3)\nif(nrow(robsgeo) > 0){\n    map <- hotspotMap(basemap = sectionmap, \n                  mapdf = robsgeo)\n    map\n}\n\n\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n------------------------------------------------------------------------\n\n### Beats\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Robbery\") %>% nrow()` total robberies thus far.\n\n```{r}\ndat <- df %>%\n    dplyr::filter(CrimeType == \"Robbery\")\n\nx <- nestedbeattable(dat)\nx <- x[substr(x$Beat, 3, 3) == section, c(\"Beat\", \"count\")] #filtering out non-relevant rows\nDT::datatable(x %>% mutate(Beat = factor(Beat)),\n              filter = 'top',\n              rownames = FALSE,\n              colnames = c(\"Beat\", \"Count\"),\n              options = list(pageLength = 100, \n                             dom = 'tf', \n                             columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\n### Weapon Types\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Robbery\") %>% nrow()` total robberies thus far.\n\n```{r}\n\nrobs %>%\n    group_by(WeaponGroup) %>%\n    count() %>%\n    arrange(desc(n)) %>%\n    ungroup() %>% \n    mutate(WeaponGroup = factor(WeaponGroup)) %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Weapon\", \"Count\"),\n                  options = list(pageLength = 100,\n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n```\n\n### Locations\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Robbery\") %>% nrow()` total robberies thus far.\n\n```{r}\n\nrobs %>% \n    group_by(LocationSceneDescription) %>%\n    count() %>%\n    arrange(desc(n)) %>%\n    ungroup() %>%\n    mutate(LocationSceneDescription = factor(LocationSceneDescription)) %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Location\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\nAggravated Assault {data-navmenu=\"Violent Crime\"}\n======================================================================\n\nColumn {data-width=400}\n-----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Aggravated Assault\", cex = 2, col = 'black')\n\n```\n\n### Projection\n\n\n```{r}\n\nasltSPC[[1]]\n\n```\n\n### Aoristic heatmap\n\n```{r}\naslts <- filter(df, CrimeType == \"Aggravated Assault\")\nmat <- aoristicDayWeek(aslts)\nplotlyhmap(mat)\n```\n\n\nColumn {data-width=400 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r}\n\nasltsgeo <- filter(df, Lat != -361 & CrimeType == \"Aggravated Assault\")\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = asltsgeo)\nmap\n\n```\n\n### 28 day Hotspot map\n\n```{r}\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = filter(asltsgeo, \n                                 SevenDaysGroup >= curr.week - 3))\nmap\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n------------------------------------------------------------------------\n\n### Beats\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Aggravated Assault\") %>% nrow()` total aggravated assaults thus far.\n\n```{r}\ndat <- df %>%\n    dplyr::filter(CrimeType == \"Aggravated Assault\")\n\nx <- nestedbeattable(dat)\nx <- x[substr(x$Beat, 3, 3) == section, c(\"Beat\", \"count\")] #filtering out non-relevant rows\nDT::datatable(x %>% mutate(Beat = factor(Beat)),\n              filter = 'top',\n              rownames = FALSE,\n              colnames = c(\"Beat\", \"Count\"),\n              options = list(pageLength = 100, \n                             dom = 'tf', \n                             columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\n### Weapon Types\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Aggravated Assault\") %>% nrow()` total aggravated assaults thus far.\n\n```{r}\n\ntable(aslts$WeaponGroup) %>%\n    as.data.frame() %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Weapon\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n```\n\n### Locations\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Aggravated Assault\") %>% nrow()` total aggravated assaults thus far.\n\n```{r}\n\naslts %>% \n    dplyr::select(LocationSceneDescription) %>%\n    table() %>%\n    as.data.frame() %>%\n    arrange(desc(Freq)) %>%\n    #kable(row.names = FALSE, col.names = c(\"Location\", \"Count\"))\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Location\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n```\n\n\nBurglary {data-navmenu=\"Property Crime\"}\n======================================================================\n\nColumn {data-width=400}\n-----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Burglary\", cex = 2, col = 'black')\n\n```\n\n### Projection\n\n```{r}\n\nburgSPC[[1]]\n\n```\n\n### Aoristic heatmap\n\n```{r}\nburgs <- filter(df, CrimeType == \"Burglary\")\nmat <- aoristicDayWeek(burgs)\nplotlyhmap(mat)\n```\n\nColumn {data-width=400 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r}\n\nburgsgeo <- filter(df, Lat != -361 & CrimeType == \"Burglary\")\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = burgsgeo)\nmap\n\n```\n\n### 28 day Hotspot map\n\n```{r}\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = filter(burgsgeo, \n                                 SevenDaysGroup >= curr.week - 3))\nmap\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### Beats\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Burglary\") %>% nrow()` total burglaries thus far.\n\n```{r}\ndat <- df %>%\n    dplyr::filter(CrimeType == \"Burglary\")\n\nx <- nestedbeattable(dat)\nx <- x[substr(x$Beat, 3, 3) == section, c(\"Beat\", \"count\")] #filtering out non-relevant rows\nDT::datatable(x %>% mutate(Beat = factor(Beat)),\n              filter ='top',\n              rownames = FALSE,\n              colnames = c(\"Beat\", \"Count\"),\n              options = list(pageLength = 100, \n                             dom = 'tf', \n                             columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\n### Locations\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Burglary\") %>% nrow()` total burglaries thus far.\n\n```{r}\ntab <- as.data.frame(table(burgs$LocationScene), stringsAsFactors = TRUE)\ntab <- tab[order(tab$Freq, decreasing = TRUE),]\n\nDT::datatable(tab, filter = 'top',\n                   rownames = FALSE,\n                   colnames = c(\"Location\", \"Count\"),\n                   options = list(pageLength = 100, \n                                  dom = 'tf',\n                                  columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\n\nLarceny {data-navmenu=\"Property Crime\"}\n======================================================================\n\nColumn {data-width=400}\n-----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Larceny\", cex = 2, col = 'black')\n\n```\n\n### Projection\n\n```{r}\n\nlarcSPC[[1]]\n\n```\n\n### Aoristic heatmap\n\n```{r}\nlarcs <- filter(df, CrimeType == \"Larceny\")\nmat <- aoristicDayWeek(larcs)\nplotlyhmap(mat)\n```\n\nColumn {data-width=400 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### YTD map\n\n```{r}\n\nlarcsgeo <- filter(df, Lat != -361 & CrimeType == \"Larceny\")\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = larcsgeo)\nmap\n\n```\n\n### 28 day map\n\n```{r}\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = filter(larcsgeo, \n                                 SevenDaysGroup >= curr.week - 3))\nmap\n\n```\n\n### YTD map - Theft from MV\n\n```{r}\n\ncarbreakins <- filter(df, Lat != -361 & \n                       CrimeType == \"Larceny\" & \n                       LarcenyTypeDescription == \"Theft from Motor Vehicle\")\nmap <- hotspotMap(basemap = sectionmap, \n                  mapdf = carbreakins)\nmap\n\n```\n\n### 28 day map - Theft from MV\n\n```{r}\nmap <- carbreakins %>%\n    filter(SevenDaysGroup >= curr.week - 3) %>%\n    hotspotMap(basemap = sectionmap)\n\nmap\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### Beats\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Larceny\") %>% nrow()` total larcenies thus far.\n\n```{r}\ndat <- df %>%\n    dplyr::filter(CrimeType == \"Larceny\")\n\nx <- nestedbeattable(dat)\nx <- x[substr(x$Beat, 3, 3) == section, c(\"Beat\", \"count\")] #filtering out non-relevant rows\nDT::datatable(x %>% mutate(Beat = factor(Beat)),\n              filter = 'top',\n              rownames = FALSE,\n              colnames = c(\"Beat\", \"Count\"),\n              options = list(pageLength = 100, \n                             dom = 'tf', \n                             columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n```\n\n### Larceny Types\n\nThere have been `r df %>% dplyr::filter(CrimeType == \"Larceny\") %>% nrow()` total larcenies thus far.\n\n```{r}\nlarcs %>%\n    group_by(LarcenyTypeDescription) %>%\n    count() %>%\n    ungroup() %>%\n    mutate(LarcenyTypeDescription = factor(LarcenyTypeDescription)) %>%\n    arrange(desc(n)) %>%\n    DT::datatable(\n              filter = 'top',\n              rownames = FALSE,\n              colnames = c(\"Larceny Type\", \"Count\"),\n              options = list(pageLength = 100, \n                             dom = 'tf',\n                             columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n```\n\nHomicide {data-navmenu=\"Violent Crime\"}\n======================================================================\n\nColumn {data-width=600 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Homicide\", cex = 2, col = 'black')\n\n```\n\n### Victims & Arrestees\n\n```{r}\nif(nrow(personincident) > 0){\n    persons <- personincident %>% \n        filter(PersonType %in% c(\"Victim\", \"Arrestee\")) %>%\n        dplyr::select(CaseNumber, Beat, DateOfEvent, DateOfDeath, \n               CaseStatus, WeaponType, PersonType, Name, DOB) %>%\n        mutate(PersonType = factor(PersonType),\n               Beat = factor(Beat),\n               WeaponType = factor(WeaponType),\n               CaseStatus = factor(CaseStatus)) %>%\n        arrange(DateOfEvent)\n    \n    DT::datatable(persons,\n                  filter = 'top',\n                  rownames = FALSE,\n                  colnames = c('Case Number', 'Beat', 'Event Date', 'Date of Death', ' Case Status', \n                               'Weapon Type', 'Person Type', 'Name', 'DOB'),\n                  options = list(pageLength = 100,\n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:8))))\n    }\n\n\n```\n\n\n### Weapon Types\n\n```{r}\nif(nrow(MCUhoms) > 0){\n    \n    DT::datatable(as.data.frame(table(MCUhoms$WeaponType)),\n                  filter = 'top',\n                  rownames = FALSE,\n                  colnames = c('Weapon', 'Count'),\n                  options = list(pageLength = 100,\n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n}\n\n```\n\n### Case status\n\n```{r}\nif(nrow(MCUhoms) > 0){\n    \n    DT::datatable(as.data.frame(table(MCUhoms$Disposition[MCUhoms$YearofEvent == curr.year], \n                                 MCUhoms$CaseStatus[MCUhoms$YearofEvent == curr.year])),\n                  filter = 'top',\n                  rownames = FALSE,\n                  colnames = c('Disposition', 'Case Status', 'Count'),\n                  options = list(pageLength = 100,\n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:2))))\n}\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r}\nhoms <- data.frame(FullAddress = MCUhoms$FullAddress,\n                   OccurToDate = MCUhoms$DateOfEvent,\n                   CaseNumber = MCUhoms$CaseNumber,\n                   Lat = MCUhoms$Lat,\n                   Lon = MCUhoms$Lon,\n                   SevenDaysGroup = MCUhoms$SevenDaysGroup,\n                   stringsAsFactors = FALSE)\n\n\n\nif(nrow(homs) == 0) {\n    cat(\"No homicides this year\")\n} else{\n    \n    map <- hotspotMap(basemap = sectionmap, \n                      mapdf = homs,\n                      doHotSpot = FALSE)\n    map\n}\n\n```\n\n### 28 day Hotspot map\n\n```{r}\nif(nrow(filter(MCUhoms, SevenDaysGroup > curr.week - 4)) == 0) {\n    cat(\"No homicides past 28 days citywide\")\n} else{\n    homs28 <- filter(homs, SevenDaysGroup >= curr.week - 3)\n    map <- hotspotMap(basemap = sectionmap, \n                      mapdf = homs28, \n                      doHotSpot = FALSE)\n    map\n}\n\n```\n\nRape {data-navmenu=\"Violent Crime\"}\n======================================================================\n\nColumn {data-width=600 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n```{r fig.align='center', fig.height = 1}\n\npar(mar=c(0,0,0,0))\nplot(c(0, 1000), c(0, 20), type = 'n', xlab = '', ylab = '', xaxt = 'n', yaxt ='n', bty = 'n')\nrect(0, 0, 1000, 20, col = 'white', border = 'darkgrey', lwd = 1)\ntext(x = 500, y = 10, labels = \"Rape\", cex = 2, col = 'black')\n\n```\n\n### Table overview\n\n```{r}\nrapes <- df %>%\n    filter(CrimeType == \"Rape\")\n\nrapes %>%\n    dplyr::select(CaseNumber, FullAddress, OccurToDate, \n           ReportDate, LocationSceneDescription, CaseStatusValue) %>%\n    mutate(LocationSceneDescription = factor(LocationSceneDescription),\n           CaseStatusValue = factor(CaseStatusValue)) %>%\n    arrange(ReportDate) %>%\n    mutate(OccurToDate = as.Date(OccurToDate, format = \"%Y-%m-%d\")) %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c('Case Number', 'Address', 'Event Date', 'Report Date', 'Location', 'Clearance'),\n                  options = list(pageLength = 100,\n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:4))))\n\n```\n\n### Victim/Offender relationship\n\n```{r}\n\ncat(\"Victim/Offender relationship data has not yet been made available by IT.\")\n\n```\n\n### Location/Scene\n\n```{r}\n\nrapes %>% \n    dplyr::select(LocationSceneDescription) %>%\n    table() %>% \n    as.data.frame() %>% \n    arrange(desc(Freq)) %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Location\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf',\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n```\n\n### Charges\n\n```{r}\nrapes %>%\n    group_by(Description) %>%\n    count() %>%\n    arrange(desc(n)) %>%\n    ungroup() %>%\n    mutate(Description = factor(Description)) %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Charge Description\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf',\n                                 ordering = FALSE,\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))  \n \n```\n\n### UCR Types\n\n```{r}\nrapes %>% \n    group_by(UCRText) %>%\n    count() %>%\n    ungroup() %>%\n    mutate(UCRText = factor(UCRText)) %>%\n    DT::datatable(filter = 'top',\n                  rownames = FALSE,\n                  colnames = c(\"Rape UCR Type\", \"Count\"),\n                  options = list(pageLength = 100, \n                                 dom = 'tf',\n                                 ordering = FALSE,\n                                 columnDefs = list(list(className = 'dt-right', targets = 0:1))))\n\n```\n\nColumn {data-width=300 .tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### YTD Hotspot map\n\n```{r}\n\nif(nrow(rapes) == 0) {\n    cat(\"No rapes this year/this section\")\n} else{\n    map <- hotspotMap(basemap = sectionmap, \n                      mapdf = rapes %>% filter(Lat != -361))\n    map\n}\n\n```\n\n### 28 day Hotspot map\n\n```{r}\nif(nrow(filter(df, Lat != -361 & \n                        CrimeType == \"Rape\" & \n                        SevenDaysGroup >= curr.week - 3)) == 0) {\n    cat(\"No rapes in the past 28 days in this section\")\n} else{\n    rapes <- filter(df, Lat != -361 & \n                        CrimeType == \"Rape\" & \n                        SevenDaysGroup >= curr.week - 3)\n    map <- hotspotMap(basemap = sectionmap, \n                      mapdf = rapes)\n    map\n}\n\n```\n\n\nReference {data-navmenu=\"Home\"}\n======================================================================\n\nColumn{data-width=200}\n-------------------------------------------------------------------------------\n\n### Action limits explained\n\nThe Rochester Police Department is shifting towards the use of \"process control\" and away from year to year comparison statistics. The goal is to be able to compare current crime counts against a benchline of \"normal\", rather than the benchline of the previous year (which may have been very high or very low compared to past years).\n\nThe Office of Business Intelligence has calculated \"action limits\" which you can see represented as dashed lines on the projection plots. These limits (both upper and lower) are calculated by using weighted 3 year averages as centering values, and then calculating the standard deviations to find how much variation from that average to expect.\n\nIf current counts for a section and crimetype break the upper action limit, it's a signal to investigate the causes of that rise in activity. If current counts break the lower action limit, it's a signal that there may be a beneficial intervention that can be studied and copied in other sections.\n\nVariation within the action limits is assumed to be normal \"statistical noise\" not requiring attention or resources above the section level.\n\n\nColumn{.tabset .tabset-fade}\n------------------------------------------------------------------------------\n\n### Case Status\n\nTreemaps display information as rectangles nested within each other. The data is structured hierarchically, meaning that a hover over a particular crime type will provide the total for that crime for the current year, but a click on a crime type will allow to drill down into the breakdown of the case statuses for that crime. To return to crime types simply click on the heading of the treemap.\n\nThe proportion of the values shown to the total are represented by the size of the corresponding rectangle.\n\nClosure and count information for homicides will be inaccurate due to LERMS data issues. Elsewhere in the dashboard, we use MCU data for homicides instead of LERMS data, but that is not possible for the treemap.\n\n![](Z:/Projects/dashboard/RPDCrimeDashboard/Objects/ReferenceTreeMap.png)\n\n### Projection\n\nThe projection chart shows the cumulative weekly values experienced to date for the current year. Points in black show values that follow the expected accumulation path. Points in green are lower than expected and points in red are higher than expected. The blue shaded region refers to the expected path to result in a value between the year-end action limits.  \n\nThe black faded points on the chart at week 53 show the results of 1000 simulations estimating what our total counts will be at year-end. The large blue point shows the average of those simulations. The black \"X\" shows the weighted average year-end totals for the past three years. The percentage of the simulations above the upper limit helps to gauge chances of year-end expectations regarding that particular crime if the remainder of the year continues as those have historically.\n\n![](Z:/Projects/dashboard/RPDCrimeDashboard/Objects/ReferenceProjectionPlot.png)\n\n### Aoristic\n\nAn aoristic heatmap shows the proportion of activity that occurs in a given hour, on a given day of the week. Lighter shades correspond with less activity, while darker red shades correspond with more activity. We have placed vertical lines that divide between first, second and third platoon hours, and as you can see from the bottom axis, the chart begins at 2300 hrs. The rectangle labeled 'Hr23' corresponds with the amount of activity occuring between 2300 and 2359 hrs on that day of the week.\n\nFor crimes that occur over a longer period of time, or for crimes that occurred at an unknown time within a time range, the weight of that crime is divided evenly between the hours that it could have occurred. For instance, the weight for a burglary that occurred at some point between 0800 and 1200 will be spread out evenly between Hr8, Hr9, Hr10 and Hr11.\n\n![](Z:/Projects/dashboard/RPDCrimeDashboard/Objects/ReferenceAoristicPlot.png)\n\n\n### Maps\n\nMost tabs have two different maps, each in their own tab. The first tab will show a Year-To-Date map, and the second tab will show a map of the last 28 days. Hotspots will also be shown if there are a large enough number of crimes for hotspots to make sense.\n\nThe Larcenies page has two additional maps for car break-ins. These maps are also on their own tabs, and display Year-To-Date car break-ins and the last 28 days of car break-ins.\n\nIf no map appears, likely there is no data to present (i.e. no events to map).\n\n![](Z:/Projects/dashboard/RPDCrimeDashboard/Objects/ReferenceMapLake.png)\n\n\n### Tables\n\nThe column on the right of each page will show additional data tables, including the breakdown of incidents by beat, by weapon type, larceny type, location type, etc...\n\n",
    "created" : 1508939530780.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1667060037",
    "id" : "395E07E8",
    "lastKnownWriteTime" : 1508780123,
    "last_content_update" : 1508939568876,
    "path" : "Z:/Projects/dashboard/RPDCrimeDashboard/CrimeDashboardRepo/CrimesSection.RMD",
    "project_path" : "CrimesSection.RMD",
    "properties" : {
        "last_setup_crc32" : "2616C0ECbe29a062",
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}