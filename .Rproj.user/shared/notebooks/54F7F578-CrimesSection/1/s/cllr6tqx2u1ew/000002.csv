"0","library(knitr)"
"0","library(flexdashboard)"
"0","library(RColorBrewer)"
"0","library(stringr)"
"0","library(ggplot2)"
"0","library(plotly)"
"2","
Attaching package: ‘plotly’

"
"2","The following object is masked from ‘package:ggplot2’:

    last_plot

"
"2","The following object is masked from ‘package:stats’:

    filter

"
"2","The following object is masked from ‘package:graphics’:

    layout

"
"0","library(KernSmooth)"
"2","KernSmooth 2.23 loaded
Copyright M. P. Wand 1997-2009
"
"0","library(raster)"
"2","Loading required package: sp
"
"2","
Attaching package: ‘raster’

"
"2","The following object is masked from ‘package:plotly’:

    select

"
"0","library(leaflet)"
"2","package ‘leaflet’ was built under R version 3.4.3"
"0","library(dplyr)"
"2","
Attaching package: ‘dplyr’

"
"2","The following objects are masked from ‘package:raster’:

    intersect, select, union

"
"2","The following objects are masked from ‘package:stats’:

    filter, lag

"
"2","The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

"
"0","library(reshape2)"
"0","library(jsonlite)"
"0","library(tidyr)"
"2","
Attaching package: ‘tidyr’

"
"2","The following object is masked from ‘package:reshape2’:

    smiths

"
"2","The following object is masked from ‘package:raster’:

    extract

"
"0","library(DT)"
"0","library(RODBC)"
"0","library(treemap)"
"0","library(d3treeR)"
"0","library(RColorBrewer)"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/aoristicDayWeek.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/guntablenest.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/kerntorast.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/hotspotMap.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/hotspotMapSV.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/LERMS_incidents.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/nestedbeattable.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/plotlyhmap.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/SPC.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/pullMCUdata.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/loadshootingvictims.R"")"
"0","source(""Z:/Projects/dashboard/RPDCrimeDashboard/Functions/CFSloc.R"")"
"0","simpleCap <- function(x) {"
"0","  s <- strsplit(x, "" "")[[1]]"
"0","  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),"
"0","      sep = """", collapse = "" "")"
"0","}"
"0","sectionsmatch <- data.frame(section = c(1, 3, 5, 7, 9),"
"0","                            sectionname = c(""Lake"", ""Genesee"", ""Goodman"", ""Clinton"", ""Central""),"
"0","                            # lng1 = c(-77.617488, -77.604633, -77.615712, -77.575370, -77.592894),"
"0","                            # lat1 = c(43.158172, 43.114570, 43.124344, 43.159093, 43.138862),"
"0","                            # lng2 = c(-77.668684, -77.686093, -77.522970, -77.626865, -77.635598),"
"0","                            # lat2 = c(43.264020, 43.159699, 43.237813, 43.257633, 43.165201),"
"0","                            stringsAsFactors = FALSE)"
"0","section <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname),""section""]"
"0","# lng1FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), ""lng1""]"
"0","# lat1FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), ""lat1""]"
"0","# lng2FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), ""lng2""]"
"0","# lat2FB <- sectionsmatch[match(params$sectionname, sectionsmatch$sectionname), ""lat2""]"
"0","overviewPlot <- function(control = controllimits %>% filter(Crime == ""Firearm""), "
"0","                         spcObj = firearmSPC,"
"0","                         dat = histdata %>% filter(CrimeType == ""Firearm""),"
"0","                         currentyear = curr.year,"
"0","                         title = ""Historical Counts for Firearm Crime"""
"0","                             ) {"
"0","    q <- dat %>% "
"0","        plot_ly("
"0","            x = ~Yr, "
"0","            y = ~Counts, "
"0","            type = ""scatter"", "
"0","            mode = ""lines+markers"","
"0","            line = list(color = ""black""),"
"0","            name = ""Historical"","
"0","            hoverinfo = ""name+x+y"","
"0","            hoverlabel = list(bgcolor = ""white"", font = list(color = ""black""))) %>% "
"0","        add_trace(data = control,"
"0","                  x = ~Year,"
"0","                  y = ~LowerLimit,"
"0","                  type = ""scatter"","
"0","                  mode = ""lines"","
"0","                  line = list(color = ""grey"", dash = ""dash""),"
"0","                  name = ""Lower Limit"","
"0","                  hoverinfo = ""name+y"","
"0","                  hoverlabel = list(bgcolor = ""white"", font = list(color = ""black""))) %>%"
"0","        add_trace(data = control,"
"0","                  x = ~Year,"
"0","                  y = ~UpperLimit,"
"0","                  type = ""scatter"","
"0","                  mode = ""lines"","
"0","                  line = list(color = ""grey"", dash = ""dash""),"
"0","                  name = ""Upper Limit"","
"0","                  hoverinfo = ""name+y"","
"0","                  hoverlabel = list(bgcolor = ""white"", font = list(color = ""black""))) %>%"
"0","        add_trace(data = spcObj[[5]] %>% group_by(Value) %>% count(),"
"0","                  x = curr.year,"
"0","                  y = ~Value,"
"0","                  type = ""scatter"","
"0","                  mode = ""markers"","
"0","                  marker = list(color = ""grey""),"
"0","                  size = ~n,"
"0","                  opacity = .3,"
"0","                  name = ""Sims"","
"0","                  hovertext = ~paste0(n, "" of 1000 sims result in "", Value, "" at year end.""),"
"0","                  hoverinfo = ""text"","
"0","                  hoverlabel = list(bgcolor = ""white"", font = list(color = ""black""))) %>%"
"0","        add_trace(x = currentyear,"
"0","                  y = mean(spcObj[[5]]$Value),"
"0","                  type = ""scatter"","
"0","                  mode = ""markers"","
"0","                  name = ""Avg sim"","
"0","                  hoverinfo = ""name"","
"0","                  marker = list(size = 10, color = ""blue"")) %>%"
"0","        layout(showlegend = FALSE,"
"0","               xaxis = list(title = """"),"
"0","               yaxis = list(title = """"),"
"0","               title = title)"
"0","    return(q)"
"0","    "
"0","}"
