---
title: "Patrol Divison Overview, as of `r format(Sys.Date() - 4, '%d %B, %Y')`"
output: 
  flexdashboard::flex_dashboard:
    logo: Y:/Projects/dashboard/RPDCrimeDashboard/Objects/RPDLogoSMALL.png
    orientation: row
    vertical_layout: fill
    theme: cerulean
---

```{r loaddata}

curr.year <- as.numeric(format(Sys.Date(), '%Y')) ### This current year to automatically reference the current year
begindate <- paste0(curr.year, '-01-01') ### For CFS to automatically create the begindate based on current year

library(tidyverse)
library(stringr)
library(knitr)
library(flexdashboard)
library(RColorBrewer)
library(plotly)
library(leaflet)
library(reshape2)
library(jsonlite)
library(DT)
library(RODBC)
library(mapview) #for cool popups
library(leaflet.extras) #for popups in GeoJSON objects

source("Y:/Projects/dashboard/RPDCrimeDashboard/Functions/LERMS_incidents.R")
source("Y:/Projects/dashboard/RPDCrimeDashboard/Functions/SPC.R")
source("Y:/Projects/dashboard/RPDCrimeDashboard/Functions/pullMCUdata.R")
source("Y:/Projects/dashboard/RPDCrimeDashboard/Functions/loadshootingvictims.R")


overviewmapfunc <- function(daddyJSON, 
                            lakeSPC, 
                            geneseeSPC, 
                            goodmanSPC, 
                            clintonSPC, 
                            centralSPC,
                            linkhash,
                            citymap,
                            sec) {
    babyJSON <- daddyJSON
    crimediff <- data_frame("Section" = sec,
                            "Difference" = c(lakeSPC[[2]] - lakeSPC[[3]],
                                             geneseeSPC[[2]] - geneseeSPC[[3]],
                                             goodmanSPC[[2]] - goodmanSPC[[3]],
                                             clintonSPC[[2]] - clintonSPC[[3]],
                                             centralSPC[[2]] - centralSPC[[3]])
                            ) %>%
        mutate(fillOpacity = abs(Difference / 100),
               fillColor = case_when(.$Difference > 0 ~ "Red",
                                     .$Difference < 0 ~ "Green",
                                     TRUE ~ "White"))
    
    crimediff <- crimediff[match(lapply(babyJSON$features, 
                                        function(x) x$properties$Section) %>% 
                                     unlist(), 
                                 crimediff$Section),]
    babyJSON$features <- lapply(
        babyJSON$features, function(x) {
            x$properties$style <- list(
                fillColor = crimediff$fillColor[which(
                    crimediff$Section == x$properties$Section)],
                fillOpacity = crimediff$fillOpacity[which(
                    crimediff$Section == x$properties$Section)]
            )
            x
        }
    )
    
    links <- data_frame(Section = sec,
                        link = c(paste0('<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/LakeCrimeDashboard.html',
                                       linkhash, 
                                       '" target="_blank">Lake Section Dashboard</a>'), 
                                 paste0('<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/GeneseeCrimeDashboard.html',
                                       linkhash, 
                                       '" target="_blank">Genesee Section Dashboard</a>'), 
                                 paste0('<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/GoodmanCrimeDashboard.html',
                                       linkhash, 
                                       '" target="_blank">Goodman Section Dashboard</a>'), 
                                 paste0('<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/ClintonCrimeDashboard.html',
                                       linkhash, 
                                       '" target="_blank">Clinton Section Dashboard</a>'), 
                                 paste0('<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/CentralCrimeDashboard.html',
                                       linkhash, 
                                       '" target="_blank">Central Section Dashboard</a>')))
    
    babyJSON$features <- lapply(babyJSON$features, function(x) {
        
        x$properties$popup = links$link[which(links$Section == x$properties$Section)]
        x
    })
    
    return(citymap %>%
               addGeoJSON(
                   babyJSON
               ) %>%
               addGeoJSONv2(
                   babyJSON,
                   fillOpacity = 0,
                   popupProperty = "popup",
                   labelProperty = "Section",
                   highlightOptions = highlightOptions(color = 'white', weight = 10, bringToFront = TRUE)
               ))
    
}

simpleCap <- function(x) {
  s <- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1,1)), tolower(substring(s, 2)),
      sep="", collapse=" ")
}

daddyJSON <- readLines("https://opendata.arcgis.com/datasets/772f3621fa354ec9abf3ba33f3ace59e_0.geojson") %>%
    paste(collapse = "\n") %>%
    fromJSON(simplifyVector = FALSE)
#gather section names and set color palettes for sections and beats
secNames <- sapply(daddyJSON$features, function(x) x$properties$Section)
sectionpal <- colorFactor(palette = colorspace::sequential_hcl(5),
                   domain = secNames)

citymap <- leaflet() %>% #Create city base map
    addProviderTiles("CartoDB.Positron") %>% 
    fitBounds(lng1 = -77.565017, lat1 = 43.127842, lng2 = -77.665216, lat2 = 43.211404)
#old fitbounds: fitBounds(lng1 = -77.55, lat1 = 43.11, lng2 = -77.668684, lat2 = 43.264020)


#sevenDayGroupTable is a lookup table to get the current week (Group) from the date
#Because it uses length(Date) from seq.Date, it should work even in leap years

sevenDayGroupTable <- data.frame(Date = seq.Date(from = as.Date(begindate),
                                                 to = as.Date(paste0(curr.year, "-12-31")),
                                                 by = 1)) %>%
    mutate(DOY = 1:length(Date),
           Group = c(rep(1:51, each = 7), 
                     rep(52, times = length(Date) - 357)))

curr.week <- sevenDayGroupTable$Group[match(as.numeric(format(Sys.Date(), 
                                                             '%j')), 
                                           sevenDayGroupTable$DOY)] - 1



firearm.desc <- trimws(c('Prohibited Use of Weapon City Limits', 
                        'Use of Dangerous Weapon', 
                        'Criminal Use Firearm 1st: Commit Violent Class B Felony', 
                        'Discharges Loaded Firearm', 
                        'Use Firearm 1st: Possess a Deadly Weapon-Loaded',
                        'Criminal Use Firearm 2nd: Possess Deadly Weapon: Loaded', 
                        'Use Firearm 1st: Display Firearm', 
                        'Criminal Use Firearm 2nd: Display Firearm'))

firearmCrimeTypes <- c("Aggravated Assault", "Robbery", "Homicide", "Rape", "Simple Assault")

#load in RPD's crime data

df <- LERMS_incidents_query(years = curr.year) %>%
    distinct(CaseNumber, FullAddress, ReportDate, Description, .keep_all = TRUE) %>%
    filter(MostSerious == 1, CaseStatusValue != 'Unfounded') %>%
    arrange(ReportDate) %>%
    mutate(CRNum = paste0(substr(CaseNumber, start = 3, stop = 5),
                          substr(CaseNumber, start = 8, stop = 13)),
           Lat = as.numeric(Lat),
           Lon = as.numeric(Lon),
           OffenseDate = as.Date(OffenseDate, format = "%Y-%m-%d"),
           ReportDate = as.Date(ReportDate, format = "%Y-%m-%d"),
           OffenseDOW = factor(OffenseDOW, 
                               levels = c("Sunday", "Monday", "Tuesday", "Wednesday",
                                   "Thursday", "Friday", "Saturday"), 
                               ordered = TRUE),
           ReportDayOfYear = as.numeric(format(ReportDate, "%j")),
           GEOBeat = factor(GEOBeat,
                            levels = unique(GEOBeat[order(substr(GEOBeat, 3, 3), 
                                                          substr(GEOBeat, 1, 2))])),
           sec = case_when(.$Section == 1 ~ "Lake", 
                           .$Section == 3 ~ "Genesee", 
                           .$Section == 5 ~ "Goodman", 
                           .$Section == 7 ~ "Clinton", 
                           .$Section == 9 ~ "Central"),
           WeaponGroup = case_when(.$WeaponIBRValue %in% c("01", "02", "03", "04", "05",
                                                         "06", "07", "08", "09", "10") ~ "Firearm",
                                   .$WeaponIBRValue == "11" ~ "Knife/Cutting Instrument",
                                   .$WeaponIBRValue == "12" ~ "Blunt Object",
                                   .$WeaponIBRValue %in% c("14", "15") ~ "Physical",
                                   TRUE ~ "Other"),
           FullAddress = unname(sapply(FullAddress, simpleCap)),
           WeaponIBRValue = as.numeric(WeaponIBRValue),
           Description = trimws(Description)) %>%
           mutate(Firearm = case_when(.$WeaponIBRValue %in% 1:10 &
                                   .$CrimeType %in% firearmCrimeTypes ~ "Firearm",
                               .$CrimeType == "Dangerous Weapons" & 
                                   .$Description %in% firearm.desc ~ "Firearm",
                               TRUE ~ "Non-Firearm")) %>%
    left_join(sevenDayGroupTable, by = c("ReportDayOfYear" = "DOY")) %>%
    select(-Date) %>%
    dplyr::rename("SevenDaysGroup" = Group) %>%
    filter(SevenDaysGroup <= curr.week) %>%
    mutate(Description = trimws(sub(x = Description, pattern = ":.*", replacement = "")))

#use beatNames to make factor levels for beats
beatNames <- df %>%
    select(GEOBeat) %>%
    unique() %>% 
    filter(! grepl(x = GEOBeat, pattern = "\\*")) %>% #remove *** as a beat name
    arrange(substr(GEOBeat, 3, 3), GEOBeat) %>%
    mutate(GEOBeat = as.factor(GEOBeat)) #this keeps *** as a factor level

CPWs <- df %>% filter(CrimeType == "Dangerous Weapons" & 
                          !trimws(Description) %in% firearm.desc &
                          as.numeric(WeaponIBRValue) < 11) %>%
    mutate(OccurFromDate = as.character(OccurFromDate)) #for table display purposes

crimes <- c('Aggravated Assault', 'Arson', 'Burglary', 'Homicide', 'Larceny', 'MV Theft', 'Rape', 'Robbery', 'Firearm')
sec <- c('Lake', 'Genesee', 'Goodman', 'Clinton', 'Central')

pal <- brewer.pal(name = "Reds", n = 9)


PropVals <- read.csv("Y:/Projects/dashboard/RPDCrimeDashboard/Objects/ProportionsAndCounts.csv", 
                     header= T)
ShootingControlLimits <- read.csv("Y:/Projects/dashboard/RPDCrimeDashboard/Objects/3YrWeightedControlLimitsShootings.csv")
ShootingProps <- read.csv("Y:/Projects/dashboard/RPDCrimeDashboard/Objects/ProportionsAndCountsShootings.csv", 
                          stringsAsFactors = FALSE)
ShootingPropsFull <- ShootingProps

histdata <- read.csv(file = "Y:/Projects/dashboard/RPDCrimeDashboard/Objects/historicaldata.csv", 
                     stringsAsFactors = FALSE, 
                     header = TRUE)

controllimits <- read.csv(file = "Y:/Projects/dashboard/RPDCrimeDashboard/Objects/3YrWeightedControlLimits.csv", 
                          header = TRUE)

controllimits <- rbind(data.frame(controllimits, Year = 2017),
                       data.frame(controllimits, Year = 2018),
                       data.frame(controllimits, Year = 2019))

mculist <- pullMCUdata()
MCUhoms <- mculist[[1]]
person <- mculist[[2]]
rm(mculist)
MCUhoms <- MCUhoms %>%
    mutate(CrimeType = "Homicide",
           DateOfEvent = as.Date(DateOfEvent, format = "%Y-%m-%d"),
           DOYofEvent = as.numeric(format(DateOfEvent, "%j")),
           YearofEvent = as.numeric(format(DateOfEvent, "%Y")),
           CaseStatus = unname(sapply(CaseStatus, simpleCap))) %>%
    filter(YearofEvent == curr.year) %>%
    dplyr::rename(sec = Section,
                  Lat = Latitude,
                  Lon = Longitude,
                  FullAddress = Address) %>%
    left_join(sevenDayGroupTable, by = c("DOYofEvent" = "DOY")) %>%
    select(-Date) %>%
    dplyr::rename("SevenDaysGroup" = Group)

personincident <- left_join(MCUhoms, person, by = "CaseNumber")

sv <- loadshootingvictims()
drops <- c("Lat", "Lon")
svjoined <- left_join(x = sv, y = df, by = c("CaseNumber" = "CRNum")) %>%
    select(-one_of(drops)) %>%
    rename(Lat = Latitude, Lon = Longitude)


```

```{r SPC}

PropValsLake <- filter(PropVals, Section == "Lake")
PropValsGenesee <- filter(PropVals, Section == "Genesee")
PropValsGoodman <- filter(PropVals, Section == "Goodman")
PropValsClinton <- filter(PropVals, Section == "Clinton")
PropValsCentral <- filter(PropVals, Section == "Central")

df.Lake <- filter(df, sec == "Lake")
df.Genesee <- filter(df, sec == "Genesee")
df.Goodman <- filter(df, sec == "Goodman")
df.Clinton <- filter(df, sec == "Clinton")
df.Central <- filter(df, sec == "Central")

firearmSPC.Lake <- SPC(crimetype = "Firearm", Prop.Vals = PropValsLake, dataf = df.Lake)
firearmSPC.Genesee <- SPC(crimetype = "Firearm", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
firearmSPC.Goodman <- SPC(crimetype = "Firearm", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
firearmSPC.Clinton <- SPC(crimetype = "Firearm", Prop.Vals = PropValsClinton, dataf = df.Clinton)
firearmSPC.Central <- SPC(crimetype = "Firearm", Prop.Vals = PropValsCentral, dataf = df.Central)

ShootingProps <- filter(ShootingPropsFull, Section == "Lake") #To avoid having to change the SPC function...
svSPC.Lake <- SPC(crimetype = "Shooting", dataf = filter(svjoined, sec == "Lake"))
ShootingProps <- filter(ShootingPropsFull, Section == "Genesee")
svSPC.Genesee <- SPC(crimetype = "Shooting", dataf = filter(svjoined, sec == "Genesee"))
ShootingProps <- filter(ShootingPropsFull, Section == "Goodman")
svSPC.Goodman <- SPC(crimetype = "Shooting", dataf = filter(svjoined, sec == "Goodman"))
ShootingProps <- filter(ShootingPropsFull, Section == "Clinton")
svSPC.Clinton <- SPC(crimetype = "Shooting", dataf = filter(svjoined, sec == "Clinton"))
ShootingProps <- filter(ShootingPropsFull, Section == "Central")
svSPC.Central <- SPC(crimetype = "Shooting", dataf = filter(svjoined, sec == "Central"))

homicideSPC.Lake <- SPC(crimetype = "Homicide", Prop.Vals = PropValsLake, dataf = df.Lake)
homicideSPC.Genesee <- SPC(crimetype = "Homicide", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
homicideSPC.Goodman <- SPC(crimetype = "Homicide", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
homicideSPC.Clinton <- SPC(crimetype = "Homicide", Prop.Vals = PropValsClinton, dataf = df.Clinton)
homicideSPC.Central <- SPC(crimetype = "Homicide", Prop.Vals = PropValsCentral, dataf = df.Central)

rapeSPC.Lake <- SPC(crimetype = "Rape", Prop.Vals = PropValsLake, dataf = df.Lake)
rapeSPC.Genesee <- SPC(crimetype = "Rape", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
rapeSPC.Goodman <- SPC(crimetype = "Rape", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
rapeSPC.Clinton <- SPC(crimetype = "Rape", Prop.Vals = PropValsClinton, dataf = df.Clinton)
rapeSPC.Central <- SPC(crimetype = "Rape", Prop.Vals = PropValsCentral, dataf = df.Central)

robSPC.Lake <- SPC(crimetype = "Robbery", Prop.Vals = PropValsLake, dataf = df.Lake)
robSPC.Genesee <- SPC(crimetype = "Robbery", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
robSPC.Goodman <- SPC(crimetype = "Robbery", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
robSPC.Clinton <- SPC(crimetype = "Robbery", Prop.Vals = PropValsClinton, dataf = df.Clinton)
robSPC.Central <- SPC(crimetype = "Robbery", Prop.Vals = PropValsCentral, dataf = df.Central)

asltSPC.Lake <- SPC(crimetype = "Aggravated Assault", Prop.Vals = PropValsLake, dataf = df.Lake)
asltSPC.Genesee <- SPC(crimetype = "Aggravated Assault", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
asltSPC.Goodman <- SPC(crimetype = "Aggravated Assault", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
asltSPC.Clinton <- SPC(crimetype = "Aggravated Assault", Prop.Vals = PropValsClinton, dataf = df.Clinton)
asltSPC.Central <- SPC(crimetype = "Aggravated Assault", Prop.Vals = PropValsCentral, dataf = df.Central)

burgSPC.Lake <- SPC(crimetype = "Burglary", Prop.Vals = PropValsLake, dataf = df.Lake)
burgSPC.Genesee <- SPC(crimetype = "Burglary", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
burgSPC.Goodman <- SPC(crimetype = "Burglary", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
burgSPC.Clinton <- SPC(crimetype = "Burglary", Prop.Vals = PropValsClinton, dataf = df.Clinton)
burgSPC.Central <- SPC(crimetype = "Burglary", Prop.Vals = PropValsCentral, dataf = df.Central)

larcSPC.Lake <- SPC(crimetype = "Larceny", Prop.Vals = PropValsLake, dataf = df.Lake)
larcSPC.Genesee <- SPC(crimetype = "Larceny", Prop.Vals = PropValsGenesee, dataf = df.Genesee)
larcSPC.Goodman <- SPC(crimetype = "Larceny", Prop.Vals = PropValsGoodman, dataf = df.Goodman)
larcSPC.Clinton <- SPC(crimetype = "Larceny", Prop.Vals = PropValsClinton, dataf = df.Clinton)
larcSPC.Central <- SPC(crimetype = "Larceny", Prop.Vals = PropValsCentral, dataf = df.Central)

```

```{r ylims}

mins <- histdata %>% 
    group_by(CrimeType) %>% 
    arrange(Counts) %>% 
    filter(rank(Counts, ties.method = "first") == 1) %>%
    ungroup()
maxes <- histdata %>% 
    group_by(CrimeType) %>% 
    arrange(Counts) %>% 
    filter(rank(Counts, ties.method = "first") == 40) %>% #5 sections, 8 years, 40 possible values
    ungroup()
```

Firearm Crime {data-navmenu="Violent Crime"} 
======================================================================

> Firearm Crime

Row
------------------------------------------------------------------------------

### Section comparison

```{r firearmtable}
#Check to make sure this year's firearm homicides are in the firearm data
#MCUhoms$CaseNumber <- paste0("20", 
#                              substr(MCUhoms$CaseNumber, 1, 3),
#                              "00", 
#                              substr(MCUhoms$CaseNumber, 4, 9))
#firearmhoms <- MCUhoms %>% 
#    filter(YearofEvent == curr.year, WeaponType == "Firearm")
#if(any(! firearmhoms$CaseNumber %in% filter(df, Firearm == "Firearm"))){
#    cat("There are firearm homicides that do not appear in the firearm data due to LERMS issues.")
#}

tab <- data.frame(Sections = sec,
                  Counts = c(firearmSPC.Lake[[4]],
                             firearmSPC.Genesee[[4]],
                             firearmSPC.Goodman[[4]],
                             firearmSPC.Clinton[[4]],
                             firearmSPC.Central[[4]]),
                  RiskOfRed = c(firearmSPC.Lake[[2]],
                               firearmSPC.Genesee[[2]],
                               firearmSPC.Goodman[[2]],
                               firearmSPC.Clinton[[2]],
                               firearmSPC.Central[[2]]),
                  ChanceOfGreen = c(firearmSPC.Lake[[3]],
                                   firearmSPC.Genesee[[3]],
                                   firearmSPC.Goodman[[3]],
                                   firearmSPC.Clinton[[3]],
                                   firearmSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))
```

### Map

```{r Firearmcrimemap}

firearmsJSON <- daddyJSON

firearmdiff <- data_frame("Section" = sec,
                          "Difference" = c(firearmSPC.Lake[[2]] - firearmSPC.Lake[[3]],
                                           firearmSPC.Genesee[[2]] - firearmSPC.Genesee[[3]],
                                           firearmSPC.Goodman[[2]] - firearmSPC.Goodman[[3]],
                                           firearmSPC.Clinton[[2]] - firearmSPC.Clinton[[3]],
                                           firearmSPC.Central[[2]] - firearmSPC.Central[[3]])) %>%
    mutate(fillOpacity = abs(Difference / 100),
           fillColor = case_when(.$Difference > 0 ~ "Red",
                             .$Difference < 0 ~ "Green",
                             TRUE ~ "White"))
firearmdiff <- firearmdiff[match(lapply(firearmsJSON$features, function(x) x$properties$Section) %>% 
                                     unlist(), 
                                 firearmdiff$Section),]

firearmsJSON$features <- lapply(firearmsJSON$features, function(x) {
    x$properties$style <- list(
        fillColor = firearmdiff$fillColor[which(firearmdiff$Section == x$properties$Section)],
        fillOpacity = firearmdiff$fillOpacity[which(firearmdiff$Section == x$properties$Section)]
    )
    x
})

links <- data_frame(Section = sec,
                    link = c('<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/LakeCrimeDashboard.html#firearm-crime-1" target="_blank">Lake Section Dashboard</a>', 
                             '<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/GeneseeCrimeDashboard.html#firearm-crime-1" target="_blank">Genesee Section Dashboard</a>', 
                             '<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/GoodmanCrimeDashboard.html#firearm-crime-1" target="_blank">Goodman Section Dashboard</a>', 
                             '<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/ClintonCrimeDashboard.html#firearm-crime-1" target="_blank">Clinton Section Dashboard</a>', 
                             '<a href="file://rpdfs.cor.local/mcac$/MCAC Operations/Crime Dashboards/CentralCrimeDashboard.html#firearm-crime-1" target="_blank">Central Section Dashboard</a>'))


firearmsJSON$features <- lapply(firearmsJSON$features, function(x) {
    
    x$properties$popup = links$link[which(links$Section == x$properties$Section)]
    x
})

citymap %>%
    addGeoJSON(
        firearmsJSON
        ) %>%
    addGeoJSONv2(
        firearmsJSON,
        fillOpacity = 0,
        popupProperty = "popup",
        labelProperty = "Section",
        highlightOptions = highlightOptions(color = "white", weight = 10, bringToFront = TRUE)
        )

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
firearmcontrol <- filter(controllimits, Crime == "Firearm")
SimsAvg <- mean(firearmSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Firearm") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- firearmcontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Firearm") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- firearmcontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)


p <- ggplot(filter(histdata, CrimeType == "Firearm", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(firearmcontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(firearmcontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = firearmSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
    
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
firearmcontrol <- filter(controllimits, Crime == "Firearm")
SimsAvg <- mean(firearmSPC.Genesee[[5]]$Value)

p <- ggplot(filter(histdata, CrimeType == "Firearm", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(firearmcontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(firearmcontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = firearmSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
    
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
firearmcontrol <- filter(controllimits, Crime == "Firearm")
SimsAvg <- mean(firearmSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Firearm", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(firearmcontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(firearmcontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = firearmSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
    
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
firearmcontrol <- filter(controllimits, Crime == "Firearm")
SimsAvg <- mean(firearmSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Firearm", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(firearmcontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(firearmcontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = firearmSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
    
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
firearmcontrol <- filter(controllimits, Crime == "Firearm")
SimsAvg <- mean(firearmSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Firearm", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(firearmcontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(firearmcontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = firearmSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
    
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

Shooting Victims{data-navmenu="Violent Crime"} 
======================================================================

> Shooting Victims

Row
------------------------------------------------------------------------------

### Section comparison

```{r shootingvictimstables}

tab <- data.frame(Sections = sec,
                  Counts = c(svSPC.Lake[[4]],
                             svSPC.Genesee[[4]],
                             svSPC.Goodman[[4]],
                             svSPC.Clinton[[4]],
                             svSPC.Central[[4]]),
                  RiskOfRed = c(svSPC.Lake[[2]],
                               svSPC.Genesee[[2]],
                               svSPC.Goodman[[2]],
                               svSPC.Clinton[[2]],
                               svSPC.Central[[2]]),
                  ChanceOfGreen = c(svSPC.Lake[[3]],
                                   svSPC.Genesee[[3]],
                                   svSPC.Goodman[[3]],
                                   svSPC.Clinton[[3]],
                                   svSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```

### Map

```{r svmap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = svSPC.Lake,
                geneseeSPC = svSPC.Genesee,
                goodmanSPC = svSPC.Goodman,
                clintonSPC = svSPC.Clinton,
                centralSPC = svSPC.Central,
                linkhash = "#shooting-victims-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
SimsAvg <- mean(svSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Shooting") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- ShootingControlLimits %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Shooting") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- ShootingControlLimits %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)

p <- ggplot(filter(histdata, CrimeType == "Shooting", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(ShootingControlLimits, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(ShootingControlLimits, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = svSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
SimsAvg <- mean(svSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Shooting", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(ShootingControlLimits, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(ShootingControlLimits, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = svSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
SimsAvg <- mean(svSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Shooting", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(ShootingControlLimits, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(ShootingControlLimits, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = svSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
SimsAvg <- mean(svSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Shooting", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(ShootingControlLimits, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(ShootingControlLimits, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = svSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
SimsAvg <- mean(svSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Shooting", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(ShootingControlLimits, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(ShootingControlLimits, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = svSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

Robbery {data-navmenu="Violent Crime"} 
======================================================================

> Robbery

Row
------------------------------------------------------------------------------

### Section comparison

```{r robberytable}

tab <- data.frame(Sections = sec,
                  Counts = c(robSPC.Lake[[4]],
                             robSPC.Genesee[[4]],
                             robSPC.Goodman[[4]],
                             robSPC.Clinton[[4]],
                             robSPC.Central[[4]]),
                  RiskOfRed = c(robSPC.Lake[[2]],
                               robSPC.Genesee[[2]],
                               robSPC.Goodman[[2]],
                               robSPC.Clinton[[2]],
                               robSPC.Central[[2]]),
                  ChanceOfGreen = c(robSPC.Lake[[3]],
                                   robSPC.Genesee[[3]],
                                   robSPC.Goodman[[3]],
                                   robSPC.Clinton[[3]],
                                   robSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```                         

### Map

```{r robmap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = robSPC.Lake,
                geneseeSPC = robSPC.Genesee,
                goodmanSPC = robSPC.Goodman,
                clintonSPC = robSPC.Clinton,
                centralSPC = robSPC.Central,
                linkhash = "#robbery-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
robcontrol <- filter(controllimits, Crime == "Robbery")
SimsAvg <- mean(robSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Robbery") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- robcontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Robbery") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- robcontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)

p <- ggplot(filter(histdata, CrimeType == "Robbery", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(robcontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(robcontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = robSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
robcontrol <- filter(controllimits, Crime == "Robbery")
SimsAvg <- mean(robSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Robbery", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(robcontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(robcontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = robSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
robcontrol <- filter(controllimits, Crime == "Robbery")
SimsAvg <- mean(robSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Robbery", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(robcontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(robcontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = robSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
robcontrol <- filter(controllimits, Crime == "Robbery")
SimsAvg <- mean(robSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Robbery", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(robcontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(robcontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = robSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
robcontrol <- filter(controllimits, Crime == "Robbery")
SimsAvg <- mean(robSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Robbery", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(robcontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(robcontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = robSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

Aggravated Assaults {data-navmenu="Violent Crime"} 
======================================================================

> Aggravated Assaults

Row
------------------------------------------------------------------------------

### Section comparison

```{r aggassaulttable}

tab <- data.frame(Sections = sec,
                  Counts = c(asltSPC.Lake[[4]],
                             asltSPC.Genesee[[4]],
                             asltSPC.Goodman[[4]],
                             asltSPC.Clinton[[4]],
                             asltSPC.Central[[4]]),
                  RiskOfRed = c(asltSPC.Lake[[2]],
                               asltSPC.Genesee[[2]],
                               asltSPC.Goodman[[2]],
                               asltSPC.Clinton[[2]],
                               asltSPC.Central[[2]]),
                  ChanceOfGreen = c(asltSPC.Lake[[3]],
                                   asltSPC.Genesee[[3]],
                                   asltSPC.Goodman[[3]],
                                   asltSPC.Clinton[[3]],
                                   asltSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```

### Map

```{r asltmap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = asltSPC.Lake,
                geneseeSPC = asltSPC.Genesee,
                goodmanSPC = asltSPC.Goodman,
                clintonSPC = asltSPC.Clinton,
                centralSPC = asltSPC.Central,
                linkhash = "#aggravated-assault-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
asltcontrol <- filter(controllimits, Crime == "Aggravated Assault")
SimsAvg <- mean(asltSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Aggravated Assault") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- asltcontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Aggravated Assault") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- asltcontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)


p <- ggplot(filter(histdata, CrimeType == "Aggravated Assault", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(asltcontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(asltcontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = asltSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
asltcontrol <- filter(controllimits, Crime == "Aggravated Assault")
SimsAvg <- mean(asltSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Aggravated Assault", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(asltcontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(asltcontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = asltSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
asltcontrol <- filter(controllimits, Crime == "Aggravated Assault")
SimsAvg <- mean(asltSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Aggravated Assault", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(asltcontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(asltcontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = asltSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
asltcontrol <- filter(controllimits, Crime == "Aggravated Assault")
SimsAvg <- mean(asltSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Aggravated Assault", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(asltcontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(asltcontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = asltSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
asltcontrol <- filter(controllimits, Crime == "Aggravated Assault")
SimsAvg <- mean(asltSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Aggravated Assault", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(asltcontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(asltcontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = asltSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```


Homicide {data-navmenu="Violent Crime"} 
======================================================================

> Homicide

Row
------------------------------------------------------------------------------

### Section comparison

```{r homicidetable}

tab <- data.frame(Sections = sec,
                  Counts = c(homicideSPC.Lake[[4]],
                             homicideSPC.Genesee[[4]],
                             homicideSPC.Goodman[[4]],
                             homicideSPC.Clinton[[4]],
                             homicideSPC.Central[[4]]),
                  RiskOfRed = c(homicideSPC.Lake[[2]],
                               homicideSPC.Genesee[[2]],
                               homicideSPC.Goodman[[2]],
                               homicideSPC.Clinton[[2]],
                               homicideSPC.Central[[2]]),
                  ChanceOfGreen = c(homicideSPC.Lake[[3]],
                                   homicideSPC.Genesee[[3]],
                                   homicideSPC.Goodman[[3]],
                                   homicideSPC.Clinton[[3]],
                                   homicideSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```

### Map

```{r hommap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = homicideSPC.Lake,
                geneseeSPC = homicideSPC.Genesee,
                goodmanSPC = homicideSPC.Goodman,
                clintonSPC = homicideSPC.Clinton,
                centralSPC = homicideSPC.Central,
                linkhash = "#homicide-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
homcontrol <- filter(controllimits, Crime == "Homicide")
SimsAvg <- mean(homicideSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Homicide") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- homcontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Homicide") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- homcontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)

p <- ggplot(filter(histdata, CrimeType == "Homicide", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(homcontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(homcontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = homicideSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
homcontrol <- filter(controllimits, Crime == "Homicide")
SimsAvg <- mean(homicideSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Homicide", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(homcontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(homcontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = homicideSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
homcontrol <- filter(controllimits, Crime == "Homicide")
SimsAvg <- mean(homicideSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Homicide", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(homcontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(homcontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = homicideSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
homcontrol <- filter(controllimits, Crime == "Homicide")
SimsAvg <- mean(homicideSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Homicide", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(homcontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(homcontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = homicideSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
homcontrol <- filter(controllimits, Crime == "Homicide")
SimsAvg <- mean(homicideSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Homicide", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(homcontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(homcontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = homicideSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

Rape {data-navmenu="Violent Crime"} 
======================================================================

> Rape

Row
------------------------------------------------------------------------------

### Section comparison

```{r rapetable}

tab <- data.frame(Sections = sec,
                  Counts = c(rapeSPC.Lake[[4]],
                             rapeSPC.Genesee[[4]],
                             rapeSPC.Goodman[[4]],
                             rapeSPC.Clinton[[4]],
                             rapeSPC.Central[[4]]),
                  RiskOfRed = c(rapeSPC.Lake[[2]],
                               rapeSPC.Genesee[[2]],
                               rapeSPC.Goodman[[2]],
                               rapeSPC.Clinton[[2]],
                               rapeSPC.Central[[2]]),
                  ChanceOfGreen = c(rapeSPC.Lake[[3]],
                                   rapeSPC.Genesee[[3]],
                                   rapeSPC.Goodman[[3]],
                                   rapeSPC.Clinton[[3]],
                                   rapeSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```

### Map

```{r rapemap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = rapeSPC.Lake,
                geneseeSPC = rapeSPC.Genesee,
                goodmanSPC = rapeSPC.Goodman,
                clintonSPC = rapeSPC.Clinton,
                centralSPC = rapeSPC.Central,
                linkhash = "#rape-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
rapecontrol <- filter(controllimits, Crime == "Rape")
SimsAvg <- mean(rapeSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Rape") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- rapecontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Rape") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- rapecontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)

p <- ggplot(filter(histdata, CrimeType == "Rape", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(rapecontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(rapecontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = rapeSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
rapecontrol <- filter(controllimits, Crime == "Rape")
SimsAvg <- mean(rapeSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Rape", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(rapecontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(rapecontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = rapeSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
rapecontrol <- filter(controllimits, Crime == "Rape")
SimsAvg <- mean(rapeSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Rape", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(rapecontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(rapecontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = rapeSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
rapecontrol <- filter(controllimits, Crime == "Rape")
SimsAvg <- mean(rapeSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Rape", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(rapecontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(rapecontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = rapeSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
rapecontrol <- filter(controllimits, Crime == "Rape")
SimsAvg <- mean(rapeSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Rape", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(rapecontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(rapecontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = rapeSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```


Burglary {data-navmenu="Property Crime"} 
======================================================================

> Burglary

Row
------------------------------------------------------------------------------

### Section comparison

```{r burgtable}

tab <- data.frame(Sections = sec,
                  Counts = c(burgSPC.Lake[[4]],
                             burgSPC.Genesee[[4]],
                             burgSPC.Goodman[[4]],
                             burgSPC.Clinton[[4]],
                             burgSPC.Central[[4]]),
                  RiskOfRed = c(burgSPC.Lake[[2]],
                               burgSPC.Genesee[[2]],
                               burgSPC.Goodman[[2]],
                               burgSPC.Clinton[[2]],
                               burgSPC.Central[[2]]),
                  ChanceOfGreen = c(burgSPC.Lake[[3]],
                                   burgSPC.Genesee[[3]],
                                   burgSPC.Goodman[[3]],
                                   burgSPC.Clinton[[3]],
                                   burgSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```

### Map

```{r burgmap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = burgSPC.Lake,
                geneseeSPC = burgSPC.Genesee,
                goodmanSPC = burgSPC.Goodman,
                clintonSPC = burgSPC.Clinton,
                centralSPC = burgSPC.Central,
                linkhash = "#burglary-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
burgcontrol <- filter(controllimits, Crime == "Burglary")
SimsAvg <- mean(burgSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Burglary") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- burgcontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Burglary") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- burgcontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)

p <- ggplot(filter(histdata, CrimeType == "Burglary", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(burgcontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(burgcontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = burgSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Genesee

```{r}
burgcontrol <- filter(controllimits, Crime == "Burglary")
SimsAvg <- mean(burgSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Burglary", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(burgcontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(burgcontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = burgSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
burgcontrol <- filter(controllimits, Crime == "Burglary")
SimsAvg <- mean(burgSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Burglary", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(burgcontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(burgcontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = burgSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
burgcontrol <- filter(controllimits, Crime == "Burglary")
SimsAvg <- mean(burgSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Burglary", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(burgcontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(burgcontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = burgSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
burgcontrol <- filter(controllimits, Crime == "Burglary")
SimsAvg <- mean(burgSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Burglary", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(burgcontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(burgcontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = burgSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```


Larceny {data-navmenu="Property Crime"} 
======================================================================

> Larceny

Row
------------------------------------------------------------------------------

### Section comparison

```{r larcenytable}

tab <- data.frame(Sections = sec,
                  Counts = c(larcSPC.Lake[[4]],
                             larcSPC.Genesee[[4]],
                             larcSPC.Goodman[[4]],
                             larcSPC.Clinton[[4]],
                             larcSPC.Central[[4]]),
                  RiskOfRed = c(larcSPC.Lake[[2]],
                               larcSPC.Genesee[[2]],
                               larcSPC.Goodman[[2]],
                               larcSPC.Clinton[[2]],
                               larcSPC.Central[[2]]),
                  ChanceOfGreen = c(larcSPC.Lake[[3]],
                                   larcSPC.Genesee[[3]],
                                   larcSPC.Goodman[[3]],
                                   larcSPC.Clinton[[3]],
                                   larcSPC.Central[[3]]))

datatable(tab,
          rownames = FALSE,
          colnames = c("Sections", 
                       "YTD Totals", 
                       "% chance of exceeding upper action limit", 
                       "% chance of beating lower action limit"),
          options = list(dom = 'tf',
                         columnDefs = list(list(className = 'dt-right', targets = 0:3))))

```

### Map

```{r larcmap}

overviewmapfunc(daddyJSON = daddyJSON,
                lakeSPC = larcSPC.Lake,
                geneseeSPC = larcSPC.Genesee,
                goodmanSPC = larcSPC.Goodman,
                clintonSPC = larcSPC.Clinton,
                centralSPC = larcSPC.Central,
                linkhash = "#larceny-1",
                citymap = citymap,
                sec = sec)

```

Row {data-height=30}
------------------------------------------------------------------------------

`r paste0("Historical Year-End Totals (2009 - ", curr.year - 1, ") with Current Year Projections")`

Row {data-height=250}
------------------------------------------------------------------------------

### Lake

```{r}
larccontrol <- filter(controllimits, Crime == "Larceny")
SimsAvg <- mean(larcSPC.Lake[[5]]$Value)

#set y axis limits
maxhist <- maxes %>% 
    filter(CrimeType == "Larceny") %>% 
    select(Counts) %>%
    as.numeric()
maxlim <- larccontrol %>% 
    select(UpperLimit) %>% 
    top_n(1, UpperLimit) %>% 
    distinct() %>% 
    as.numeric()
ymax <- max(maxhist, maxlim) * 1.1

minhist <- mins %>% 
    filter(CrimeType == "Larceny") %>% 
    select(Counts) %>% 
    as.numeric()
minlim <- larccontrol %>% 
    top_n(1, -LowerLimit) %>% 
    select(LowerLimit) %>%
    distinct() %>% 
    as.numeric()
ymin <- min(minhist, minlim)

p <- ggplot(filter(histdata, CrimeType == "Larceny", Section == 1), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(larccontrol, Section == 'Lake'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(larccontrol, Section == 'Lake'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = larcSPC.Lake[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```


### Genesee

```{r}
larccontrol <- filter(controllimits, Crime == "Larceny")
SimsAvg <- mean(larcSPC.Genesee[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Larceny", Section == 3), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(larccontrol, Section == 'Genesee'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(larccontrol, Section == 'Genesee'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = larcSPC.Genesee[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Goodman

```{r}
larccontrol <- filter(controllimits, Crime == "Larceny")
SimsAvg <- mean(larcSPC.Goodman[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Larceny", Section == 5), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(larccontrol, Section == 'Goodman'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(larccontrol, Section == 'Goodman'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = larcSPC.Goodman[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Clinton

```{r}
larccontrol <- filter(controllimits, Crime == "Larceny")
SimsAvg <- mean(larcSPC.Clinton[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Larceny", Section == 7), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(larccontrol, Section == 'Clinton'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(larccontrol, Section == 'Clinton'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = larcSPC.Clinton[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```

### Central

```{r}
larccontrol <- filter(controllimits, Crime == "Larceny")
SimsAvg <- mean(larcSPC.Central[[5]]$Value)
p <- ggplot(filter(histdata, CrimeType == "Larceny", Section == 9), aes(x = Yr, y = Counts)) +
    geom_line() +
    #geom_point() +
    theme_bw() +
    geom_line(data = filter(larccontrol, Section == 'Central'), aes(x = Year, y = UpperLimit), linetype = "dashed") +
    geom_line(data = filter(larccontrol, Section == 'Central'), aes(x = Year, y = LowerLimit), linetype = "dashed") +
    #scale_x_continuous(breaks = 2009:2019) +
    geom_point(data = larcSPC.Central[[5]], aes(x = curr.year, y = Value), alpha = .01) +
    geom_point(aes(x = curr.year, y = SimsAvg), shape = 16, size = 3, color = 'blue') +
    labs(x = "Year") +
    scale_y_continuous(limits = c(ymin, ymax)) +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())
ggplotly(p, tooltip = c("Yr", "Counts", "SimsAvg"))
```
